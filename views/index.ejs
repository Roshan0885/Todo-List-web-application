<%- include('partials/header') %>
  <main>
    <% if (typeof message !== 'undefined' && message) { %>
      <script>alert("<%= message %>");</script>
    <% } %>

    <form id="addForm" action="/add" method="POST">
      <input type="text" id="taskInput" name="task" placeholder="Enter a new task" required>
      <select name="priority">
        <option value="Low">Low</option>
        <option value="Medium" selected>Medium</option>
        <option value="High">High</option>
      </select>
      <button type="submit">Add Task</button>
    </form>

    <form action="/" method="GET">
      <label for="filter">Filter:</label>
      <select name="filter" onchange="this.form.submit()">
        <option value="">All</option>
        <option value="Low" <%= (typeof filter !== 'undefined' && filter === 'Low') ? 'selected' : '' %>>Low</option>
        <option value="Medium" <%= (typeof filter !== 'undefined' && filter === 'Medium') ? 'selected' : '' %>>Medium</option>
        <option value="High" <%= (typeof filter !== 'undefined' && filter === 'High') ? 'selected' : '' %>>High</option>
      </select>
    </form>

    <ul>
      <% todos.forEach((todo, index) => { %>
        <li>
          <form action="/edit/<%= index %>?_method=PUT" method="POST">
            <input type="text" name="task" value="<%= todo.task %>">
            <select name="priority">
              <option value="Low" <%= todo.priority === 'Low' ? 'selected' : '' %>>Low</option>
              <option value="Medium" <%= todo.priority === 'Medium' ? 'selected' : '' %>>Medium</option>
              <option value="High" <%= todo.priority === 'High' ? 'selected' : '' %>>High</option>
            </select>
            <button type="submit">Update</button>
          </form>
          <form action="/delete/<%= index %>?_method=DELETE" method="POST">
            <button type="submit" style="background: #dc3545;">Delete</button>
          </form>
        </li>
      <% }); %>
    </ul>
  </main>


<%- include('partials/footer') %>